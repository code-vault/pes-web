"use client";
import { useState, useEffect, useRef } from 'react';
import { X, Bot, Send, User, Sparkles, MessageSquare } from 'lucide-react';
import { useLocale } from 'next-intl';

// Chatbot Knowledge Base
const solarKnowledge = {
  en: {
    greetings: [
      "Hello! I'm your Solar Energy Assistant. I can help you with costs, subsidies, installation, financing, and technical questions. What would you like to know?",
      "Hi there! I'm here to help you understand solar energy solutions. Ask me about costs, government subsidies, installation types, or savings!",
      "Welcome! I can answer questions about solar costs, installation process, government subsidies, financing options, and more. How can I help?"
    ],
    
    quickReplies: [
      { text: "ЁЯТ░ Solar Costs", keyword: "cost" },
      { text: "ЁЯПЫя╕П Government Subsidies", keyword: "subsidy" },
      { text: "ЁЯФз Installation Process", keyword: "installation" },
      { text: "ЁЯТ│ Financing Options", keyword: "financing" },
      { text: "тЪб System Types", keyword: "types" },
      { text: "ЁЯУК Savings Calculator", keyword: "savings" }
    ],

    responses: {
      cost: [
        "ЁЯТ░ **Solar System Costs in India:**\n\nтАв **Residential (1-10kW):** тВ╣40,000-тВ╣80,000 per kW\nтАв **Commercial (10kW+):** тВ╣35,000-тВ╣65,000 per kW\nтАв **5kW home system:** тВ╣2-4 lakhs (after subsidies)\nтАв **10kW system:** тВ╣4-7 lakhs (after subsidies)\n\n*Prices include panels, inverter, installation & 5-year warranty*\n\nWould you like a personalized quote? ЁЯУЛ"
      ],
      
      subsidy: [
        "ЁЯПЫя╕П **Government Subsidies Available:**\n\nтАв **Central Subsidy:** Up to тВ╣18,000 per kW (max 3kW)\nтАв **State Subsidies:** Additional 10-30% in many states\nтАв **Net Metering:** Sell excess power back to grid\nтАв **Tax Benefits:** 30% depreciation for businesses\nтАв **Low-interest loans:** 2-6% interest rates\n\n**Example:** 5kW system costs тВ╣3L тЖТ After subsidy тВ╣1.8L\n\nWhich state are you in? I can check specific subsidies! ЁЯЧ║я╕П"
      ],
      
      installation: [
        "ЁЯФз **Solar Installation Process:**\n\n**Step 1:** Site Survey & Design (1-2 days)\n**Step 2:** Permits & Approvals (7-15 days)\n**Step 3:** Equipment Procurement (3-7 days)\n**Step 4:** Installation (1-3 days)\n**Step 5:** Grid Connection & Testing (2-5 days)\n**Step 6:** Net Metering Setup (7-30 days)\n\nтП▒я╕П **Total Time:** 3-8 weeks\nЁЯПа **Roof Requirements:** 100 sq ft per kW\n\nNeed a site assessment? We offer free surveys! ЁЯУЛ"
      ],
      
      financing: [
        "ЁЯТ│ **Solar Financing Options:**\n\n**1. Cash Purchase** тЬЕ Best ROI, immediate ownership\n**2. Solar Loan** ЁЯПж 2-6% interest, 5-15 year terms\n**3. Lease/PPA** ЁЯУД тВ╣0 down, pay monthly\n**4. NBFC Financing** ЁЯТ░ Up to 80% funding\n\n**EMI Example:**\nтВ╣5L system тЖТ тВ╣8,500/month for 5 years\nSavings: тВ╣12,000/month\n**Net Benefit:** тВ╣3,500/month from day 1! ЁЯУИ\n\nWant to calculate your EMI? ЁЯзо"
      ],
      
      types: [
        "тЪб **Solar System Types:**\n\n**ЁЯФМ On-Grid (Grid-Tied)**\nтАв Connected to electricity grid\nтАв Sell excess power back\nтАв No battery backup\nтАв Cost: тВ╣40-60k per kW\nтАв Best for: Reliable grid areas\n\n**ЁЯФЛ Off-Grid (Standalone)**\nтАв Complete independence\nтАв Battery backup included\nтАв Works during power cuts\nтАв Cost: тВ╣80-120k per kW\nтАв Best for: Remote areas\n\n**тЪбЁЯФЛ Hybrid System**\nтАв Best of both worlds\nтАв Grid connection + batteries\nтАв Backup during outages\nтАв Cost: тВ╣70-100k per kW\nтАв Best for: Urban areas with power cuts\n\nWhich type interests you? ЁЯдФ"
      ],
      
      savings: [
        "ЁЯУК **Solar Savings Calculator:**\n\n**Example 5kW System:**\nтАв Monthly Generation: 750 units\nтАв Current Bill: тВ╣15,000/month\nтАв With Solar: тВ╣2,000/month\nтАв **Monthly Savings: тВ╣13,000** ЁЯТ░\nтАв **Annual Savings: тВ╣1,56,000** ЁЯУИ\nтАв **25-year Savings: тВ╣39 lakhs** ЁЯОп\n\n**Payback Period:** 3-4 years\n**ROI:** 25-30% annually\n\nTo calculate YOUR savings, I need:\nтАв Monthly electricity bill amount\nтАв Location (for sunlight hours)\nтАв Roof space available\n\nShall we calculate your potential savings? ЁЯзо"
      ],
      
      technical: [
        "ЁЯФм **Technical Information:**\n\n**Panel Types:**\nтАв Monocrystalline: 20-22% efficiency, premium\nтАв Polycrystalline: 18-20% efficiency, economical\nтАв Bifacial: 25% more power, latest technology\n\n**Inverter Types:**\nтАв String Inverters: Cost-effective\nтАв Power Optimizers: Better performance\nтАв Microinverters: Maximum efficiency\n\n**System Specifications:**\nтАв Warranty: 25 years on panels, 5-12 years on inverters\nтАв Performance: 80% efficiency after 25 years\nтАв Maintenance: Minimal, cleaning 2-4 times/year\n\nAny specific technical questions? тЪЩя╕П"
      ],
      
      maintenance: [
        "ЁЯз╣ **Solar Maintenance Guide:**\n\n**Monthly:** Visual inspection\n**Quarterly:** Panel cleaning (more in dusty areas)\n**Annually:** Professional checkup\n\n**Cleaning Tips:**\nтАв Early morning or evening\nтАв Use soft brush and water\nтАв Avoid harsh chemicals\nтАв Professional cleaning available\n\n**Monitoring:**\nтАв Mobile app for performance tracking\nтАв Alert system for issues\nтАв Remote monitoring included\n\n**Costs:** тВ╣2-5k annually\n**Performance impact:** 15-20% loss if not cleaned\n\nWant to know about our maintenance packages? ЁЯФз"
      ]
    },

    fallback: [
      "I understand you're asking about solar energy! While I might not have the exact answer, I can help with costs, subsidies, installation, financing, system types, or savings calculations. Could you try asking about one of these topics?",
      "That's a great question! I specialize in solar costs, government subsidies, installation process, financing options, system types (on-grid/off-grid/hybrid), and savings calculations. Could you rephrase your question using one of these topics?",
      "I'm here to help with solar energy questions! I can provide detailed information about pricing, government incentives, installation procedures, financing, technical specifications, and potential savings. What specific aspect would you like to know about?"
    ],

    leadCapture: [
      "I'd love to provide you with a personalized quote! Could you share:\nтАв Your location\nтАв Monthly electricity bill\nтАв Available roof space\n\nOr would you prefer our expert to call you? ЁЯУЮ",
      "To give you accurate information, I'll need a few details. Would you like to:\nтАв Get a quick online estimate\nтАв Schedule a free site visit\nтАв Speak with our solar consultant\n\nWhat works best for you? ЁЯдФ"
    ]
  },

  hi: {
    greetings: [
      "рдирдорд╕реНрддреЗ! рдореИрдВ рдЖрдкрдХрд╛ рд╕реЛрд▓рд░ рдПрдирд░реНрдЬреА рдЕрд╕рд┐рд╕реНрдЯреЗрдВрдЯ рд╣реВрдВред рдореИрдВ рд▓рд╛рдЧрдд, рд╕рдмреНрд╕рд┐рдбреА, рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди, рдлрд╛рдЗрдиреЗрдВрд╕рд┐рдВрдЧ рдФрд░ рддрдХрдиреАрдХреА рд╕рд╡рд╛рд▓реЛрдВ рдореЗрдВ рдЖрдкрдХреА рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред рдЖрдк рдХреНрдпрд╛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?",
      "рд╣реИрд▓реЛ! рдореИрдВ рд╕реЛрд▓рд░ рдПрдирд░реНрдЬреА рд╕реЙрд▓реНрдпреВрд╢рдиреНрд╕ рд╕рдордЭрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ рд╣реВрдВред рдореБрдЭрд╕реЗ рд▓рд╛рдЧрдд, рд╕рд░рдХрд╛рд░реА рд╕рдмреНрд╕рд┐рдбреА, рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдХреЗ рдкреНрд░рдХрд╛рд░ рдпрд╛ рдмрдЪрдд рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫреЗрдВ!",
      "рд╕реНрд╡рд╛рдЧрдд рд╣реИ! рдореИрдВ рд╕реЛрд▓рд░ рд▓рд╛рдЧрдд, рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛, рд╕рд░рдХрд╛рд░реА рд╕рдмреНрд╕рд┐рдбреА, рдлрд╛рдЗрдиреЗрдВрд╕рд┐рдВрдЧ рд╡рд┐рдХрд▓реНрдк рдФрд░ рдмрд╣реБрдд рдХреБрдЫ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рд╡рд╛рд▓реЛрдВ рдХрд╛ рдЬрд╡рд╛рдм рджреЗ рд╕рдХрддрд╛ рд╣реВрдВред рдореИрдВ рдХреИрд╕реЗ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ?"
    ],

    quickReplies: [
      { text: "ЁЯТ░ рд╕реЛрд▓рд░ рд▓рд╛рдЧрдд", keyword: "cost" },
      { text: "ЁЯПЫя╕П рд╕рд░рдХрд╛рд░реА рд╕рдмреНрд╕рд┐рдбреА", keyword: "subsidy" },
      { text: "ЁЯФз рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛", keyword: "installation" },
      { text: "ЁЯТ│ рдлрд╛рдЗрдиреЗрдВрд╕рд┐рдВрдЧ рд╡рд┐рдХрд▓реНрдк", keyword: "financing" },
      { text: "тЪб рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдкреНрд░рдХрд╛рд░", keyword: "types" },
      { text: "ЁЯУК рдмрдЪрдд рдХреИрд▓рдХреБрд▓реЗрдЯрд░", keyword: "savings" }
    ],

    responses: {
      cost: [
        "ЁЯТ░ **рднрд╛рд░рдд рдореЗрдВ рд╕реЛрд▓рд░ рд╕рд┐рд╕реНрдЯрдо рдХреА рд▓рд╛рдЧрдд:**\n\nтАв **рдЖрд╡рд╛рд╕реАрдп (1-10kW):** тВ╣40,000-тВ╣80,000 рдкреНрд░рддрд┐ kW\nтАв **рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ (10kW+):** тВ╣35,000-тВ╣65,000 рдкреНрд░рддрд┐ kW\nтАв **5kW рдШрд░реЗрд▓реВ рд╕рд┐рд╕реНрдЯрдо:** тВ╣2-4 рд▓рд╛рдЦ (рд╕рдмреНрд╕рд┐рдбреА рдХреЗ рдмрд╛рдж)\nтАв **10kW рд╕рд┐рд╕реНрдЯрдо:** тВ╣4-7 рд▓рд╛рдЦ (рд╕рдмреНрд╕рд┐рдбреА рдХреЗ рдмрд╛рдж)\n\n*рдХреАрдорддреЛрдВ рдореЗрдВ рдкреИрдирд▓, рдЗрдиреНрд╡рд░реНрдЯрд░, рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдФрд░ 5 рд╕рд╛рд▓ рдХреА рд╡рд╛рд░рдВрдЯреА рд╢рд╛рдорд┐рд▓ рд╣реИ*\n\nрдХреНрдпрд╛ рдЖрдкрдХреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдХреЛрдЯреЗрд╢рди рдЪрд╛рд╣рд┐рдП? ЁЯУЛ"
      ],
      
      subsidy: [
        "ЁЯПЫя╕П **рдЙрдкрд▓рдмреНрдз рд╕рд░рдХрд╛рд░реА рд╕рдмреНрд╕рд┐рдбреА:**\n\nтАв **рдХреЗрдВрджреНрд░реАрдп рд╕рдмреНрд╕рд┐рдбреА:** тВ╣18,000 рдкреНрд░рддрд┐ kW рддрдХ (рдЕрдзрд┐рдХрддрдо 3kW)\nтАв **рд░рд╛рдЬреНрдп рд╕рдмреНрд╕рд┐рдбреА:** рдХрдИ рд░рд╛рдЬреНрдпреЛрдВ рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд 10-30%\nтАв **рдиреЗрдЯ рдореАрдЯрд░рд┐рдВрдЧ:** рдЕрддрд┐рд░рд┐рдХреНрдд рдмрд┐рдЬрд▓реА рдЧреНрд░рд┐рдб рдХреЛ рдмреЗрдЪреЗрдВ\nтАв **рдЯреИрдХреНрд╕ рд▓рд╛рдн:** рд╡реНрдпрд╡рд╕рд╛рдпреЛрдВ рдХреЗ рд▓рд┐рдП 30% рдбреЗрдкреНрд░рд┐рд╕рд┐рдПрд╢рди\nтАв **рдХрдо рдмреНрдпрд╛рдЬ рд▓реЛрди:** 2-6% рдмреНрдпрд╛рдЬ рджрд░реЗрдВ\n\n**рдЙрджрд╛рд╣рд░рдг:** 5kW рд╕рд┐рд╕реНрдЯрдо рд▓рд╛рдЧрдд тВ╣3L тЖТ рд╕рдмреНрд╕рд┐рдбреА рдХреЗ рдмрд╛рдж тВ╣1.8L\n\nрдЖрдк рдХрд┐рд╕ рд░рд╛рдЬреНрдп рдореЗрдВ рд╣реИрдВ? рдореИрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдмреНрд╕рд┐рдбреА рдЪреЗрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ! ЁЯЧ║я╕П"
      ],
      
      installation: [
        "ЁЯФз **рд╕реЛрд▓рд░ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛:**\n\n**рдЪрд░рдг 1:** рд╕рд╛рдЗрдЯ рд╕рд░реНрд╡реЗ рдФрд░ рдбрд┐рдЬрд╝рд╛рдЗрди (1-2 рджрд┐рди)\n**рдЪрд░рдг 2:** рдкрд░рдорд┐рдЯ рдФрд░ рдЕрдиреБрдореЛрджрди (7-15 рджрд┐рди)\n**рдЪрд░рдг 3:** рдЙрдкрдХрд░рдг рдЦрд░реАрджрд╛рд░реА (3-7 рджрд┐рди)\n**рдЪрд░рдг 4:** рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди (1-3 рджрд┐рди)\n**рдЪрд░рдг 5:** рдЧреНрд░рд┐рдб рдХрдиреЗрдХреНрд╢рди рдФрд░ рдЯреЗрд╕реНрдЯрд┐рдВрдЧ (2-5 рджрд┐рди)\n**рдЪрд░рдг 6:** рдиреЗрдЯ рдореАрдЯрд░рд┐рдВрдЧ рд╕реЗрдЯрдЕрдк (7-30 рджрд┐рди)\n\nтП▒я╕П **рдХреБрд▓ рд╕рдордп:** 3-8 рд╕рдкреНрддрд╛рд╣\nЁЯПа **рдЫрдд рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛:** 100 рд╡рд░реНрдЧ рдлреБрдЯ рдкреНрд░рддрд┐ kW\n\nрд╕рд╛рдЗрдЯ рдЕрд╕реЗрд╕рдореЗрдВрдЯ рдЪрд╛рд╣рд┐рдП? рд╣рдо рдореБрдлреНрдд рд╕рд░реНрд╡реЗ рдХрд░рддреЗ рд╣реИрдВ! ЁЯУЛ"
      ],
      
      financing: [
        "ЁЯТ│ **рд╕реЛрд▓рд░ рдлрд╛рдЗрдиреЗрдВрд╕рд┐рдВрдЧ рд╡рд┐рдХрд▓реНрдк:**\n\n**1. рдирдХрдж рдЦрд░реАрджрд╛рд░реА** тЬЕ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ ROI, рддрддреНрдХрд╛рд▓ рд╕реНрд╡рд╛рдорд┐рддреНрд╡\n**2. рд╕реЛрд▓рд░ рд▓реЛрди** ЁЯПж 2-6% рдмреНрдпрд╛рдЬ, 5-15 рд╕рд╛рд▓ рдХреА рдЕрд╡рдзрд┐\n**3. рд▓реАрдЬ/PPA** ЁЯУД тВ╣0 рдбрд╛рдЙрди рдкреЗрдореЗрдВрдЯ, рдорд╛рд╕рд┐рдХ рднреБрдЧрддрд╛рди\n**4. NBFC рдлрд╛рдЗрдиреЗрдВрд╕рд┐рдВрдЧ** ЁЯТ░ 80% рддрдХ рдлрдВрдбрд┐рдВрдЧ\n\n**EMI рдЙрджрд╛рд╣рд░рдг:**\nтВ╣5L рд╕рд┐рд╕реНрдЯрдо тЖТ тВ╣8,500/рдорд╛рд╣ 5 рд╕рд╛рд▓ рдХреЗ рд▓рд┐рдП\nрдмрдЪрдд: тВ╣12,000/рдорд╛рд╣\n**рд╢реБрджреНрдз рд▓рд╛рдн:** рдкрд╣рд▓реЗ рджрд┐рди рд╕реЗ тВ╣3,500/рдорд╛рд╣! ЁЯУИ\n\nрдЕрдкрдиреА EMI рдХреИрд▓рдХреБрд▓реЗрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? ЁЯзо"
      ],
      
      types: [
        "тЪб **рд╕реЛрд▓рд░ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдкреНрд░рдХрд╛рд░:**\n\n**ЁЯФМ рдСрди-рдЧреНрд░рд┐рдб (рдЧреНрд░рд┐рдб-рдЯрд╛рдЗрдб)**\nтАв рдмрд┐рдЬрд▓реА рдЧреНрд░рд┐рдб рд╕реЗ рдЬреБрдбрд╝рд╛\nтАв рдЕрддрд┐рд░рд┐рдХреНрдд рдмрд┐рдЬрд▓реА рд╡рд╛рдкрд╕ рдмреЗрдЪреЗрдВ\nтАв рдмреИрдЯрд░реА рдмреИрдХрдЕрдк рдирд╣реАрдВ\nтАв рд▓рд╛рдЧрдд: тВ╣40-60k рдкреНрд░рддрд┐ kW\nтАв рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛: рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдЧреНрд░рд┐рдб рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП\n\n**ЁЯФЛ рдСрдл-рдЧреНрд░рд┐рдб (рд╕реНрдЯреИрдВрдбрдЕрд▓реЛрди)**\nтАв рдкреВрд░реНрдг рд╕реНрд╡рддрдВрддреНрд░рддрд╛\nтАв рдмреИрдЯрд░реА рдмреИрдХрдЕрдк рд╢рд╛рдорд┐рд▓\nтАв рдмрд┐рдЬрд▓реА рдХрдЯреМрддреА рдХреЗ рджреМрд░рд╛рди рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ\nтАв рд▓рд╛рдЧрдд: тВ╣80-120k рдкреНрд░рддрд┐ kW\nтАв рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛: рджреВрд░рджрд░рд╛рдЬ рдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП\n\n**тЪбЁЯФЛ рд╣рд╛рдЗрдмреНрд░рд┐рдб рд╕рд┐рд╕реНрдЯрдо**\nтАв рджреЛрдиреЛрдВ рджреБрдирд┐рдпрд╛ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛\nтАв рдЧреНрд░рд┐рдб рдХрдиреЗрдХреНрд╢рди + рдмреИрдЯрд░реА\nтАв рдЖрдЙрдЯреЗрдЬ рдХреЗ рджреМрд░рд╛рди рдмреИрдХрдЕрдк\nтАв рд▓рд╛рдЧрдд: тВ╣70-100k рдкреНрд░рддрд┐ kW\nтАв рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛: рдмрд┐рдЬрд▓реА рдХрдЯреМрддреА рд╡рд╛рд▓реЗ рд╢рд╣рд░реА рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП\n\nрдХреМрди рд╕рд╛ рдкреНрд░рдХрд╛рд░ рдЖрдкрдХреА рд░реБрдЪрд┐ рдХрд╛ рд╣реИ? ЁЯдФ"
      ],
      
      savings: [
        "ЁЯУК **рд╕реЛрд▓рд░ рдмрдЪрдд рдХреИрд▓рдХреБрд▓реЗрдЯрд░:**\n\n**рдЙрджрд╛рд╣рд░рдг 5kW рд╕рд┐рд╕реНрдЯрдо:**\nтАв рдорд╛рд╕рд┐рдХ рдЙрддреНрдкрд╛рджрди: 750 рдпреВрдирд┐рдЯ\nтАв рд╡рд░реНрддрдорд╛рди рдмрд┐рд▓: тВ╣15,000/рдорд╛рд╣\nтАв рд╕реЛрд▓рд░ рдХреЗ рд╕рд╛рде: тВ╣2,000/рдорд╛рд╣\nтАв **рдорд╛рд╕рд┐рдХ рдмрдЪрдд: тВ╣13,000** ЁЯТ░\nтАв **рд╡рд╛рд░реНрд╖рд┐рдХ рдмрдЪрдд: тВ╣1,56,000** ЁЯУИ\nтАв **25-рд╕рд╛рд▓ рдХреА рдмрдЪрдд: тВ╣39 рд▓рд╛рдЦ** ЁЯОп\n\n**рдкреЗрдмреИрдХ рдЕрд╡рдзрд┐:** 3-4 рд╕рд╛рд▓\n**ROI:** рд╕рд╛рд▓рд╛рдирд╛ 25-30%\n\nрдЖрдкрдХреА рдмрдЪрдд рдХреИрд▓рдХреБрд▓реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореБрдЭреЗ рдЪрд╛рд╣рд┐рдП:\nтАв рдорд╛рд╕рд┐рдХ рдмрд┐рдЬрд▓реА рдмрд┐рд▓ рдХреА рд░рд╛рд╢рд┐\nтАв рд╕реНрдерд╛рди (рдзреВрдк рдХреЗ рдШрдВрдЯреЛрдВ рдХреЗ рд▓рд┐рдП)\nтАв рдЙрдкрд▓рдмреНрдз рдЫрдд рдХреА рдЬрдЧрд╣\n\nрдХреНрдпрд╛ рд╣рдо рдЖрдкрдХреА рд╕рдВрднрд╛рд╡рд┐рдд рдмрдЪрдд рдХреИрд▓рдХреБрд▓реЗрдЯ рдХрд░реЗрдВ? ЁЯзо"
      ]
    },

    fallback: [
      "рдореИрдВ рд╕рдордЭ рдЧрдпрд╛ рдХрд┐ рдЖрдк рд╕реЛрд▓рд░ рдПрдирд░реНрдЬреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫ рд░рд╣реЗ рд╣реИрдВ! рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдореЗрд░реЗ рдкрд╛рд╕ рд╕рдЯреАрдХ рдЬрд╡рд╛рдм рди рд╣реЛ, рд▓реЗрдХрд┐рди рдореИрдВ рд▓рд╛рдЧрдд, рд╕рдмреНрд╕рд┐рдбреА, рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди, рдлрд╛рдЗрдиреЗрдВрд╕рд┐рдВрдЧ, рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХрд╛рд░ рдпрд╛ рдмрдЪрдд рдЧрдгрдирд╛ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред рдХреНрдпрд╛ рдЖрдк рдЗрди рд╡рд┐рд╖рдпреЛрдВ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ?",
      "рдпрд╣ рдПрдХ рдмреЗрд╣рддрд░реАрди рд╕рд╡рд╛рд▓ рд╣реИ! рдореИрдВ рд╕реЛрд▓рд░ рд▓рд╛рдЧрдд, рд╕рд░рдХрд╛рд░реА рд╕рдмреНрд╕рд┐рдбреА, рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдлрд╛рдЗрдиреЗрдВрд╕рд┐рдВрдЧ рд╡рд┐рдХрд▓реНрдк, рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХрд╛рд░ (рдСрди-рдЧреНрд░рд┐рдб/рдСрдл-рдЧреНрд░рд┐рдб/рд╣рд╛рдЗрдмреНрд░рд┐рдб), рдФрд░ рдмрдЪрдд рдЧрдгрдирд╛ рдореЗрдВ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╣реВрдВред рдХреНрдпрд╛ рдЖрдк рдЗрди рд╡рд┐рд╖рдпреЛрдВ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рджреЛрдмрд╛рд░рд╛ рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ?"
    ],

    leadCapture: [
      "рдореБрдЭреЗ рдЖрдкрдХреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдХреЛрдЯреЗрд╢рди рджреЗрдирд╛ рдкрд╕рдВрдж рд╣реЛрдЧрд╛! рдХреНрдпрд╛ рдЖрдк рд╕рд╛рдЭрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:\nтАв рдЖрдкрдХрд╛ рд╕реНрдерд╛рди\nтАв рдорд╛рд╕рд┐рдХ рдмрд┐рдЬрд▓реА рдмрд┐рд▓\nтАв рдЙрдкрд▓рдмреНрдз рдЫрдд рдХреА рдЬрдЧрд╣\n\nрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдЖрдкрдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ? ЁЯУЮ",
      "рдЖрдкрдХреЛ рд╕рдЯреАрдХ рдЬрд╛рдирдХрд╛рд░реА рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, рдореБрдЭреЗ рдХреБрдЫ рд╡рд┐рд╡рд░рдг рдЪрд╛рд╣рд┐рдПред рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣реЗрдВрдЧреЗ:\nтАв рддреБрд░рдВрдд рдСрдирд▓рд╛рдЗрди рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдирд╛\nтАв рдореБрдлреНрдд рд╕рд╛рдЗрдЯ рд╡рд┐рдЬрд╝рд┐рдЯ рд╢реЗрдбреНрдпреВрд▓ рдХрд░рдирд╛\nтАв рд╣рдорд╛рд░реЗ рд╕реЛрд▓рд░ рд╕рд▓рд╛рд╣рдХрд╛рд░ рд╕реЗ рдмрд╛рдд рдХрд░рдирд╛\n\nрдЖрдкрдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣реИ? ЁЯдФ"
    ]
  }
};

// Enhanced keyword detection
const detectIntent = (message: string, locale: string) => {
  const msg = message.toLowerCase();
  
  // Cost related keywords
  if (msg.match(/(cost|price|rate|charge|рд▓рд╛рдЧрдд|рдХреАрдордд|рджрд░|рдЦрд░реНрдЪ)/)) return 'cost';
  
  // Subsidy related keywords  
  if (msg.match(/(subsidy|subsidi|incentive|government|рд╕рдмреНрд╕рд┐рдбреА|рд╕рд░рдХрд╛рд░реА|рдкреНрд░реЛрддреНрд╕рд╛рд╣рди)/)) return 'subsidy';
  
  // Installation related keywords
  if (msg.match(/(install|setup|process|installation|рдЗрдВрд╕реНрдЯреЙрд▓|рд╕реНрдерд╛рдкрдирд╛|рдкреНрд░рдХреНрд░рд┐рдпрд╛)/)) return 'installation';
  
  // Financing related keywords
  if (msg.match(/(loan|finance|emi|payment|рд▓реЛрди|рд╡рд┐рддреНрдд|рднреБрдЧрддрд╛рди|рдХрд┐рд╕реНрдд)/)) return 'financing';
  
  // System types
  if (msg.match(/(grid|off.?grid|on.?grid|hybrid|type|рдЧреНрд░рд┐рдб|рд╣рд╛рдЗрдмреНрд░рд┐рдб|рдкреНрд░рдХрд╛рд░)/)) return 'types';
  
  // Savings related keywords
  if (msg.match(/(save|saving|benefit|profit|рдмрдЪрдд|рдлрд╛рдпрджрд╛|рд▓рд╛рдн)/)) return 'savings';
  
  // Technical keywords
  if (msg.match(/(technical|panel|inverter|efficiency|рддрдХрдиреАрдХреА|рдкреИрдирд▓|рдЗрдиреНрд╡рд░реНрдЯрд░)/)) return 'technical';
  
  // Maintenance keywords
  if (msg.match(/(maintenance|clean|service|рд░рдЦрд░рдЦрд╛рд╡|рд╕рдлрд╛рдИ|рд╕реЗрд╡рд╛)/)) return 'maintenance';
  
  return 'fallback';
};

const AIChatbot = () => {
  const [showChat, setShowChat] = useState(false);
  const [isVisible, setIsVisible] = useState(false);
  const [messages, setMessages] = useState<Array<{text: string, isBot: boolean, timestamp: Date}>>([]);
  const [inputMessage, setInputMessage] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [showQuickReplies, setShowQuickReplies] = useState(true);
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const locale = useLocale();

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  useEffect(() => {
    console.log('AI Chatbot mounted');
    const timer = setTimeout(() => {
      setIsVisible(true);
      console.log('AI Chatbot is now visible');
    }, 2000);
    return () => clearTimeout(timer);
  }, []);

  const addMessage = (text: string, isBot: boolean = false) => {
    setMessages(prev => [...prev, { text, isBot, timestamp: new Date() }]);
  };

  const getBotResponse = (userMessage: string) => {
    const intent = detectIntent(userMessage, locale);
    const lang = locale === 'hi' ? 'hi' : 'en';
    const responses = solarKnowledge[lang].responses;
    
    if (responses[intent as keyof typeof responses]) {
      const responseArray = responses[intent as keyof typeof responses];
      return responseArray[Math.floor(Math.random() * responseArray.length)];
    }
    
    // Fallback response
    const fallbacks = solarKnowledge[lang].fallback;
    return fallbacks[Math.floor(Math.random() * fallbacks.length)];
  };

  const handleSendMessage = (message: string = inputMessage) => {
    if (!message.trim()) return;
    
    // Add user message
    addMessage(message, false);
    setInputMessage('');
    setShowQuickReplies(false);
    setIsTyping(true);
    
    // Simulate typing delay
    setTimeout(() => {
      const response = getBotResponse(message);
      addMessage(response, true);
      setIsTyping(false);
      
      // Show lead capture after 3 interactions
      if (messages.length > 4 && Math.random() > 0.7) {
        setTimeout(() => {
          const lang = locale === 'hi' ? 'hi' : 'en';
          const leadMsg = solarKnowledge[lang].leadCapture[Math.floor(Math.random() * solarKnowledge[lang].leadCapture.length)];
          addMessage(leadMsg, true);
        }, 2000);
      }
    }, 1000 + Math.random() * 1000);
  };

  const handleQuickReply = (keyword: string) => {
    const lang = locale === 'hi' ? 'hi' : 'en';
    const quickReply = solarKnowledge[lang].quickReplies.find(qr => qr.keyword === keyword);
    if (quickReply) {
      handleSendMessage(quickReply.text);
    }
  };

  const initializeChat = () => {
    if (messages.length === 0) {
      const lang = locale === 'hi' ? 'hi' : 'en';
      const greeting = solarKnowledge[lang].greetings[Math.floor(Math.random() * solarKnowledge[lang].greetings.length)];
      addMessage(greeting, true);
    }
  };

  const openChat = () => {
    console.log('Opening AI Solar Chatbot');
    setShowChat(true);
    initializeChat();
  };

  const closeChat = () => {
    setShowChat(false);
  };

  if (!isVisible) return null;

  return (
    <>
      {/* AI Chatbot Button */}
      <div 
        style={{ 
          position: 'fixed', 
          bottom: '24px', 
          right: '24px', 
          zIndex: 9999,
          fontFamily: 'system-ui, -apple-system, sans-serif'
        }}
      >
        <button
          onClick={openChat}
          style={{
            width: '70px',
            height: '70px',
            borderRadius: '50%',
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            border: 'none',
            color: 'white',
            cursor: 'pointer',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            boxShadow: '0 8px 32px rgba(102, 126, 234, 0.4)',
            transition: 'all 0.3s ease',
            position: 'relative',
            overflow: 'hidden'
          }}
          onMouseOver={(e) => {
            e.currentTarget.style.transform = 'scale(1.1)';
            e.currentTarget.style.boxShadow = '0 12px 40px rgba(102, 126, 234, 0.6)';
          }}
          onMouseOut={(e) => {
            e.currentTarget.style.transform = 'scale(1)';
            e.currentTarget.style.boxShadow = '0 8px 32px rgba(102, 126, 234, 0.4)';
          }}
          title={locale === 'hi' ? 'AI рд╕реЛрд▓рд░ рдЕрд╕рд┐рд╕реНрдЯреЗрдВрдЯ рд╕реЗ рдмрд╛рдд рдХрд░реЗрдВ' : 'Chat with AI Solar Assistant'}
        >
          {/* Animated background */}
          <div style={{
            position: 'absolute',
            inset: 0,
            background: 'linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%)',
            animation: 'shimmer 3s infinite linear'
          }}></div>
          
          {/* Main Bot Icon */}
          <Bot size={32} style={{ zIndex: 1 }} />
          
          {/* AI Badge */}
          <div style={{
            position: 'absolute',
            top: '-4px',
            right: '-4px',
            width: '28px',
            height: '28px',
            background: 'linear-gradient(135deg, #ff6b6b, #ee5a24)',
            borderRadius: '50%',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            fontSize: '10px',
            fontWeight: 'bold',
            color: 'white',
            border: '3px solid white',
            boxShadow: '0 2px 8px rgba(0,0,0,0.2)'
          }}>
            AI
          </div>
          
          {/* Sparkle Animation */}
          <Sparkles 
            size={16} 
            style={{
              position: 'absolute',
              top: '8px',
              left: '8px',
              animation: 'sparkle 2s infinite ease-in-out',
              opacity: 0.8
            }} 
          />
          
          {/* Pulse Ring */}
          <div style={{
            position: 'absolute',
            inset: '-8px',
            borderRadius: '50%',
            border: '2px solid rgba(102, 126, 234, 0.3)',
            animation: 'pulse-ring 2s infinite cubic-bezier(0.4, 0, 0.6, 1)'
          }}></div>
        </button>

        {/* Chat Indicator */}
        {!showChat && (
          <div style={{
            position: 'absolute',
            bottom: '80px',
            right: '0',
            background: 'rgba(0,0,0,0.8)',
            color: 'white',
            padding: '8px 12px',
            borderRadius: '20px',
            fontSize: '12px',
            fontWeight: '500',
            whiteSpace: 'nowrap',
            opacity: 0,
            animation: 'slideInFade 0.5s ease-out 3s forwards',
            boxShadow: '0 4px 12px rgba(0,0,0,0.3)'
          }}>
            ЁЯТм {locale === 'hi' ? 'AI рд╕реЗ рдкреВрдЫреЗрдВ' : 'Ask AI'}
          </div>
        )}
      </div>

      {/* Enhanced AI Chat Modal */}
      {showChat && (
        <div style={{
          position: 'fixed',
          bottom: '110px',
          right: '24px',
          width: '380px',
          height: '500px',
          background: 'white',
          borderRadius: '20px',
          boxShadow: '0 25px 60px rgba(0,0,0,0.4)',
          border: '1px solid #e5e7eb',
          zIndex: 10000,
          display: 'flex',
          flexDirection: 'column',
          fontFamily: 'system-ui, -apple-system, sans-serif',
          overflow: 'hidden',
          animation: 'slideUpFade 0.3s ease-out'
        }}>
          {/* Enhanced Chat Header */}
          <div style={{
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            color: 'white',
            padding: '20px',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            borderTopLeftRadius: '20px',
            borderTopRightRadius: '20px',
            position: 'relative',
            overflow: 'hidden'
          }}>
            {/* Animated background */}
            <div style={{
              position: 'absolute',
              inset: 0,
              background: 'linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%)',
              animation: 'shimmer 4s infinite linear'
            }}></div>
            
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', zIndex: 1 }}>
              <div style={{
                width: '44px',
                height: '44px',
                background: 'rgba(255,255,255,0.2)',
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                position: 'relative'
              }}>
                <Bot size={24} />
                <div style={{
                  position: 'absolute',
                  top: '-2px',
                  right: '-2px',
                  width: '12px',
                  height: '12px',
                  background: '#10b981',
                  borderRadius: '50%',
                  border: '2px solid white'
                }}></div>
              </div>
              <div>
                <h3 style={{ margin: 0, fontSize: '16px', fontWeight: 'bold', display: 'flex', alignItems: 'center', gap: '6px' }}>
                  {locale === 'hi' ? 'рдкреВрд░реНрд╡реЛрджрдп AI рд╕реЛрд▓рд░ рдПрдХреНрд╕рдкрд░реНрдЯ' : 'Purvodaya AI Solar Expert'}
                  <Sparkles size={16} style={{ opacity: 0.8 }} />
                </h3>
                <p style={{ margin: 0, fontSize: '12px', opacity: 0.9 }}>
                  тЪб {locale === 'hi' ? 'рддреБрд░рдВрдд рдЬрд╡рд╛рдм рджреЗрддрд╛ рд╣реИ' : 'Instant Solar Answers'}
                </p>
              </div>
            </div>
            <button
              onClick={closeChat}
              style={{
                background: 'rgba(255,255,255,0.2)',
                border: 'none',
                borderRadius: '50%',
                width: '36px',
                height: '36px',
                color: 'white',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                transition: 'background 0.2s ease',
                zIndex: 1
              }}
              onMouseOver={(e) => e.currentTarget.style.background = 'rgba(255,255,255,0.3)'}
              onMouseOut={(e) => e.currentTarget.style.background = 'rgba(255,255,255,0.2)'}
            >
              <X size={18} />
            </button>
          </div>

          {/* Chat Messages Area */}
          <div style={{ 
            flex: 1, 
            padding: '20px', 
            overflowY: 'auto',
            display: 'flex',
            flexDirection: 'column',
            gap: '16px',
            background: 'linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%)'
          }}>
            {messages.map((message, index) => (
              <div key={index} style={{
                display: 'flex',
                flexDirection: message.isBot ? 'row' : 'row-reverse',
                alignItems: 'flex-start',
                gap: '12px',
                animation: `messageSlide 0.3s ease-out ${index * 0.1}s backwards`
              }}>
                {message.isBot && (
                  <div style={{
                    width: '32px',
                    height: '32px',
                    background: 'linear-gradient(135deg, #667eea, #764ba2)',
                    borderRadius: '50%',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    flexShrink: 0,
                    boxShadow: '0 2px 8px rgba(102, 126, 234, 0.3)'
                  }}>
                    <Bot size={16} color="white" />
                  </div>
                )}
                
                <div style={{
                  background: message.isBot ? 'white' : 'linear-gradient(135deg, #667eea, #764ba2)',
                  color: message.isBot ? '#374151' : 'white',
                  padding: '14px 16px',
                  borderRadius: message.isBot ? '18px 18px 18px 6px' : '18px 18px 6px 18px',
                  fontSize: '14px',
                  maxWidth: '75%',
                  lineHeight: '1.5',
                  whiteSpace: 'pre-line',
                  boxShadow: message.isBot ? '0 2px 12px rgba(0,0,0,0.1)' : '0 2px 12px rgba(102, 126, 234, 0.3)',
                  border: message.isBot ? '1px solid #e5e7eb' : 'none'
                }}>
                  {message.text}
                </div>
                
                {!message.isBot && (
                  <div style={{
                    width: '32px',
                    height: '32px',
                    background: '#e5e7eb',
                    borderRadius: '50%',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    flexShrink: 0
                  }}>
                    <User size={16} color="#6b7280" />
                  </div>
                )}
              </div>
            ))}

            {/* Enhanced Typing Indicator */}
            {isTyping && (
              <div style={{
                display: 'flex',
                alignItems: 'flex-start',
                gap: '12px',
                animation: 'messageSlide 0.3s ease-out'
              }}>
                <div style={{
                  width: '32px',
                  height: '32px',
                  background: 'linear-gradient(135deg, #667eea, #764ba2)',
                  borderRadius: '50%',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  boxShadow: '0 2px 8px rgba(102, 126, 234, 0.3)'
                }}>
                  <Bot size={16} color="white" />
                </div>
                <div style={{
                  background: 'white',
                  padding: '14px 16px',
                  borderRadius: '18px 18px 18px 6px',
                  border: '1px solid #e5e7eb',
                  boxShadow: '0 2px 12px rgba(0,0,0,0.1)'
                }}>
                  <div style={{
                    display: 'flex',
                    gap: '4px',
                    alignItems: 'center'
                  }}>
                    <div style={{
                      width: '8px',
                      height: '8px',
                      background: '#667eea',
                      borderRadius: '50%',
                      animation: 'bounce 1.4s infinite ease-in-out'
                    }}></div>
                    <div style={{
                      width: '8px',
                      height: '8px',
                      background: '#667eea',
                      borderRadius: '50%',
                      animation: 'bounce 1.4s infinite ease-in-out 0.16s'
                    }}></div>
                    <div style={{
                      width: '8px',
                      height: '8px',
                      background: '#667eea',
                      borderRadius: '50%',
                      animation: 'bounce 1.4s infinite ease-in-out 0.32s'
                    }}></div>
                  </div>
                </div>
              </div>
            )}

            {/* Enhanced Quick Reply Buttons */}
            {showQuickReplies && messages.length > 0 && (
              <div style={{
                display: 'flex',
                flexDirection: 'column',
                gap: '8px',
                marginTop: '12px',
                animation: 'slideUpFade 0.5s ease-out 0.5s backwards'
              }}>
                <div style={{
                  fontSize: '12px',
                  color: '#6b7280',
                  fontWeight: '600',
                  marginBottom: '4px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '4px'
                }}>
                  <MessageSquare size={14} />
                  {locale === 'hi' ? 'рддреНрд╡рд░рд┐рдд рд╡рд┐рдХрд▓реНрдк:' : 'Quick topics:'}
                </div>
                <div style={{
                  display: 'flex',
                  flexWrap: 'wrap',
                  gap: '6px'
                }}>
                  {solarKnowledge[locale === 'hi' ? 'hi' : 'en'].quickReplies.slice(0, 6).map((reply, index) => (
                    <button
                      key={index}
                      onClick={() => handleQuickReply(reply.keyword)}
                      style={{
                        background: 'white',
                        border: '1px solid #e5e7eb',
                        borderRadius: '20px',
                        padding: '8px 12px',
                        fontSize: '12px',
                        cursor: 'pointer',
                        transition: 'all 0.2s ease',
                        color: '#374151',
                        fontWeight: '500',
                        boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                      }}
                      onMouseOver={(e) => {
                        e.currentTarget.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                        e.currentTarget.style.color = 'white';
                        e.currentTarget.style.transform = 'translateY(-1px)';
                        e.currentTarget.style.boxShadow = '0 4px 8px rgba(102, 126, 234, 0.3)';
                      }}
                      onMouseOut={(e) => {
                        e.currentTarget.style.background = 'white';
                        e.currentTarget.style.color = '#374151';
                        e.currentTarget.style.transform = 'translateY(0)';
                        e.currentTarget.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
                      }}
                    >
                      {reply.text}
                    </button>
                  ))}
                </div>
              </div>
            )}

            <div ref={messagesEndRef} />
          </div>

          {/* Enhanced Chat Input */}
          <div style={{ 
            padding: '20px', 
            borderTop: '1px solid #e5e7eb',
            background: 'white',
            borderBottomLeftRadius: '20px',
            borderBottomRightRadius: '20px'
          }}>
            <form onSubmit={(e) => { e.preventDefault(); handleSendMessage(); }} style={{
              display: 'flex',
              gap: '12px',
              alignItems: 'flex-end'
            }}>
              <input
                type="text"
                value={inputMessage}
                onChange={(e) => setInputMessage(e.target.value)}
                placeholder={locale === 'hi' ? 'рд╕реЛрд▓рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫреЗрдВ...' : 'Ask about solar energy...'}
                style={{
                  flex: 1,
                  padding: '12px 16px',
                  border: '2px solid #e5e7eb',
                  borderRadius: '25px',
                  fontSize: '14px',
                  outline: 'none',
                  transition: 'all 0.2s ease',
                  background: '#f8fafc'
                }}
                onFocus={(e) => {
                  e.currentTarget.style.borderColor = '#667eea';
                  e.currentTarget.style.background = 'white';
                }}
                onBlur={(e) => {
                  e.currentTarget.style.borderColor = '#e5e7eb';
                  e.currentTarget.style.background = '#f8fafc';
                }}
              />
              <button
                type="submit"
                disabled={!inputMessage.trim() || isTyping}
                style={{
                  background: inputMessage.trim() ? 'linear-gradient(135deg, #667eea, #764ba2)' : '#e5e7eb',
                  color: 'white',
                  border: 'none',
                  borderRadius: '50%',
                  width: '44px',
                  height: '44px',
                  cursor: inputMessage.trim() ? 'pointer' : 'not-allowed',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  transition: 'all 0.2s ease',
                  flexShrink: 0,
                  boxShadow: inputMessage.trim() ? '0 4px 12px rgba(102, 126, 234, 0.3)' : 'none'
                }}
                onMouseOver={(e) => {
                  if (inputMessage.trim()) {
                    e.currentTarget.style.transform = 'scale(1.05)';
                    e.currentTarget.style.boxShadow = '0 6px 16px rgba(102, 126, 234, 0.4)';
                  }
                }}
                onMouseOut={(e) => {
                  e.currentTarget.style.transform = 'scale(1)';
                  e.currentTarget.style.boxShadow = inputMessage.trim() ? '0 4px 12px rgba(102, 126, 234, 0.3)' : 'none';
                }}
              >
                <Send size={18} />
              </button>
            </form>
            
            {/* Enhanced powered by indicator */}
            <div style={{
              textAlign: 'center',
              marginTop: '12px',
              fontSize: '11px',
              color: '#9ca3af',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              gap: '4px'
            }}>
              <Sparkles size={12} />
              {locale === 'hi' ? 'AI рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд' : 'Powered by AI'} тАв {locale === 'hi' ? 'рдкреВрд░реНрд╡реЛрджрдп рдПрдирд░реНрдЬреА' : 'Purvodaya Energy'}
            </div>
          </div>
        </div>
      )}

      {/* Enhanced CSS Animations */}
      <style jsx>{`
        @keyframes shimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }
        
        @keyframes sparkle {
          0%, 100% { opacity: 0.5; transform: scale(0.8); }
          50% { opacity: 1; transform: scale(1.2); }
        }
        
        @keyframes pulse-ring {
          0% { transform: scale(0.8); opacity: 1; }
          100% { transform: scale(1.2); opacity: 0; }
        }
        
        @keyframes slideInFade {
          from {
            opacity: 0;
            transform: translateX(20px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        
        @keyframes slideUpFade {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes messageSlide {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes bounce {
          0%, 80%, 100% {
            transform: scale(0);
          }
          40% {
            transform: scale(1);
          }
        }
      `}</style>
    </>
  );
};

export default AIChatbot;